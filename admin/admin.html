<!DOCTYPE html>
<html lang="—Ä—É">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω–∫–∞ Influence Lab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .modal-bg { background: rgba(0,0,0,0.5); }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Login Form -->
  <div id="login-section" class="flex items-center justify-center min-—Ö-screen">
    <form id="login-form" class="bg-white p-8 rounded-xl shadow-xl w-full max-w-xs space-y-6">
      <h2 class="text-2xl font-bold text-center mb-4">–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h2>
      <input type="text" id="login" placeholder="–õ–æ–≥–∏–Ω" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue-soft" required>
      <div class="relative mt-2">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full px-4 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue-soft" required>
        <button type="button" id="toggle-password" tabindex="-1" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-700" style="display:none;">
          <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12s3.75-7.5 9.75-7.5 9.75 7.5 9.75 7.5-3.75 7.5-9.75 7.5S2.25 12 2.25 12z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
          </svg>
        </button>
      </div>
      <button type="submit" class="w-full bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:from-blue-600 hover:to-blue-800 transition-all duration-200">–í–æ–π—Ç–∏</button>
      <div id="login-error" class="text-red-500 text-sm text-center hidden">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
    </form>
  </div>

  <!-- Admin Panel -->
  <div id="admin-section" class="hidden px-4 py-8 max-w-5xl mx-auto">
    <div class="sticky top-0 bg-gray-50 z-10 mb-8 border-b pb-4">
      <div class="flex justify-between items-center">
        <h1 id="admin-title" class="text-3xl font-bold">–ê–¥–º–∏–Ω–∫–∞</h1>
        <div class="flex gap-2 items-center">
          <button id="add-btn" class="bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white px-6 py-2 rounded-lg font-semibold shadow hover:from-blue-600 hover:to-blue-800 transition-all duration-200">+ –ü–æ—Å—Ç</button>
          <button id="add-project-btn" class="bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white px-6 py-2 rounded-lg font-semibold shadow hover:from-blue-600 hover:to-blue-800 transition-all duration-200">+ –ü—Ä–æ–µ–∫—Ç</button>
          <button id="add-led-btn" class="bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white px-6 py-2 rounded-lg font-semibold shadow hover:from-blue-600 hover:to-blue-800 transition-all duration-200">+ LED</button>
          <button id="logout-btn" class="ml-2 px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition">–í—ã–π—Ç–∏</button>
        </div>
      </div>
      <div class="mt-4 flex gap-2">
        <button id="tab-blog" class="px-4 py-2 rounded-full bg-blue-100 text-blue-700 font-semibold">–ë–ª–æ–≥</button>
        <button id="tab-projects" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300">–ü—Ä–æ–µ–∫—Ç—ã</button>
        <button id="tab-led" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300">LED —ç–∫—Ä–∞–Ω—ã</button>
      </div>
    </div>

    <div id="blog-section">
      <div id="blog-list" class="space-y-4"></div>
    </div>

    <div id="projects-section" class="hidden">
      <div id="projects-list" class="space-y-4"></div>
    </div>

    <div id="led-section" class="hidden">
      <div id="led-list" class="space-y-4"></div>
    </div>
  </div>

  <!-- Modal (Add/Edit) -->
  <div id="modal-bg" class="modal-bg fixed inset-0 z-40 flex items-center justify-center hidden p-4">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] relative flex flex-col">
      <div class="flex-shrink-0 p-6 border-b">
        <button id="modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-black text-2xl">&times;</button>
        <h2 id="modal-title" class="text-2xl font-bold">–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç</h2>
      </div>
      <div class="flex-1 overflow-y-auto p-6">
        <form id="modal-form" class="space-y-6">
        <input type="hidden" id="modal-id">
        <input type="hidden" id="modal-img-old">
        
        <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∏ -->
        <div class="bg-gray-50 p-4 rounded-lg">
          <label class="block mb-2 font-semibold text-lg">üì∏ –ö–∞—Ä—Ç–∏–Ω–∫–∏ (–¥–æ 10)</label>
          <input type="file" id="modal-imgs" name="imgs[]" multiple class="w-full px-4 py-3 border rounded-lg bg-white" accept="image/*">
          <input type="hidden" id="modal-images-old">
          <div id="img-preview" class="mt-3 grid grid-cols-4 gap-3"></div>
        </div>
        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ -->
        <div class="bg-blue-50 p-4 rounded-lg">
          <label class="block mb-3 font-semibold text-lg">üìù –ó–∞–≥–æ–ª–æ–≤–∫–∏</label>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div>
              <label class="block mb-2 font-semibold text-sm text-gray-700">üá∑üá∫ –†—É—Å—Å–∫–∏–π (RU)</label>
              <input type="text" id="modal-title-input" class="w-full px-4 py-3 border rounded-lg" required>
            </div>
            <div>
              <label class="block mb-2 font-semibold text-sm text-gray-700">üá∫üáø O'zbekcha (UZ)</label>
              <input type="text" id="modal-title-uz" class="w-full px-4 py-3 border rounded-lg bg-gray-50" placeholder="–ü–µ—Ä–µ–≤–µ–¥–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏">
            </div>
            <div>
              <label class="block mb-2 font-semibold text-sm text-gray-700">üá∫üá∏ English (EN)</label>
              <input type="text" id="modal-title-en" class="w-full px-4 py-3 border rounded-lg bg-gray-50" placeholder="–ü–µ—Ä–µ–≤–µ–¥–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏">
            </div>
          </div>
        </div>
        <!-- –û–ø–∏—Å–∞–Ω–∏—è -->
        <div class="bg-green-50 p-4 rounded-lg">
          <label class="block mb-3 font-semibold text-lg">üìÑ –û–ø–∏—Å–∞–Ω–∏—è</label>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div>
              <label class="block mb-2 font-semibold text-sm text-gray-700">üá∑üá∫ –†—É—Å—Å–∫–∏–π (RU)</label>
              <textarea id="modal-desc" class="w-full px-4 py-3 border rounded-lg" rows="4" required></textarea>
            </div>
            <div>
              <label class="block mb-2 font-semibold text-sm text-gray-700">üá∫üáø O'zbekcha (UZ)</label>
              <textarea id="modal-desc-uz" class="w-full px-4 py-3 border rounded-lg bg-gray-50" rows="4" placeholder="–ü–µ—Ä–µ–≤–µ–¥–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"></textarea>
            </div>
            <div>
              <label class="block mb-2 font-semibold text-sm text-gray-700">üá∫üá∏ English (EN)</label>
              <textarea id="modal-desc-en" class="w-full px-4 py-3 border rounded-lg bg-gray-50" rows="4" placeholder="–ü–µ—Ä–µ–≤–µ–¥–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"></textarea>
            </div>
          </div>
        </div>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è LED —ç–∫—Ä–∞–Ω–æ–≤ -->
        <div id="led-extra-block" class="hidden bg-yellow-50 p-4 rounded-lg">
          <label class="block mb-3 font-semibold text-lg">üìç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
          <div>
            <label class="block mb-2 font-semibold text-sm text-gray-700">üìç –õ–æ–∫–∞—Ü–∏—è</label>
            <input type="text" id="modal-location" class="w-full px-4 py-3 border rounded-lg" placeholder="–ê–¥—Ä–µ—Å –∏–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã LED —ç–∫—Ä–∞–Ω–∞">
          </div>
        </div>
        <!-- –°—Å—ã–ª–∫–∏ -->
        <div id="links-block" class="bg-purple-50 p-4 rounded-lg">
          <label class="block mb-3 font-semibold text-lg">üîó –°—Å—ã–ª–∫–∏ (–¥–æ 5)</label>
          <div id="links-container" class="space-y-3"></div>
          <button type="button" id="add-link-btn" class="mt-3 px-4 py-2 text-sm rounded bg-purple-500 text-white hover:bg-purple-600 transition font-semibold">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="flex-shrink-0 pt-4 border-t space-y-3">
          <button type="button" id="translate-all-btn" class="w-full bg-gradient-to-r from-green-500 via-green-600 to-green-700 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-green-800 transition-all duration-200 shadow-lg">üîÑ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å—ë</button>
          <button id="modal-save-btn" type="submit" class="w-full bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 text-white py-4 rounded-lg font-semibold text-lg hover:from-blue-600 hover:to-blue-800 transition-all duration-200 shadow-lg">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>
    </div>
  </div>

  <script>
    // --- AUTH ---
    const loginSection = document.getElementById('login-section');
    const adminSection = document.getElementById('admin-section');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    // --- localStorage auth check ---
    if (localStorage.getItem('isAdmin') === '1') {
      loginSection.classList.add('hidden');
      adminSection.classList.remove('hidden');
      loadBlog();
      loadProjects();
      loadLed();
    }
    // --- Password eye toggle ---
    const passwordInput = document.getElementById('password');
    const togglePasswordBtn = document.getElementById('toggle-password');
    const eyeIcon = document.getElementById('eye-icon');
    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
    passwordInput.addEventListener('input', () => {
      togglePasswordBtn.style.display = passwordInput.value ? 'block' : 'none';
    });
    togglePasswordBtn.addEventListener('click', () => {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      eyeIcon.innerHTML = type === 'password'
        ? `<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12s3.75-7.5 9.75-7.5 9.75 7.5 9.75 7.5-3.75 7.5-9.75 7.5S2.25 12 2.25 12z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />`
        : `<path stroke-linecap="round" stroke-linejoin="round" d="M3 3l18 18M2.25 12s3.75-7.5 9.75-7.5c2.28 0 4.36.6 6.18 1.6M21.75 12s-3.75 7.5-9.75 7.5c-2.28 0-4.36-.6-6.18-1.6" />`;
    });
    loginForm.onsubmit = (e) => {
      e.preventDefault();
      const login = document.getElementById('login').value.trim();
      const pass = document.getElementById('password').value;
      if (login === 'infadmin' && pass === 'infadmin123') {
        loginSection.classList.add('hidden');
        adminSection.classList.remove('hidden');
        localStorage.setItem('isAdmin', '1');
        loadBlog();
        loadProjects();
        loadLed();
      } else {
        loginError.classList.remove('hidden');
      }
    };

    // --- BLOG CRUD ---
    const blogList = document.getElementById('blog-list');
    function blogCard(post) {
      return `<div class="bg-white rounded-xl shadow flex flex-col md:flex-row items-center md:items-start gap-6 p-4">
        <img src="${post.img}" alt="img" class="w-32 h-32 object-cover rounded-lg border">
        <div class="flex-1">
          <div class="font-bold text-lg mb-1">${post.title}</div>
          <div class="text-gray-600 mb-2">${post.description}</div>
          <div class="flex gap-2">
            <button onclick="editBlog(${post.id})" class="px-4 py-1 bg-yellow-400 text-white rounded hover:bg-yellow-500">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button onclick="deleteBlog(${post.id})" class="px-4 py-1 bg-red-500 text-white rounded hover:bg-red-600">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>`;
    }
    function loadBlog() {
      fetch('/api/blog').then(r=>r.json()).then(posts => {
        blogList.innerHTML = posts.length ? posts.map(blogCard).join('') : '<div class="text-gray-400 text-center">–ù–µ—Ç –ø–æ—Å—Ç–æ–≤</div>';
      });
    }
    window.editBlog = function(id) {
      fetch(`/api/blog/${id}`).then(r=>r.json()).then(post => {
        openModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç', post, 'blog');
      });
    }
    window.deleteBlog = function(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?')) return;
      fetch(`/api/blog/${id}`, {method:'DELETE'}).then(()=>loadBlog());
    }

    // --- PROJECTS CRUD ---
    const projectsList = document.getElementById('projects-list');
    function projectCard(item) {
      return `<div class="bg-white rounded-xl shadow flex flex-col md:flex-row items-center md:items-start gap-6 p-4">
        <img src="${item.img}" alt="img" class="w-32 h-32 object-cover rounded-lg border">
        <div class="flex-1">
          <div class="font-bold text-lg mb-1">${item.title}</div>
          <div class="text-gray-600 mb-2">${item.description}</div>
          <div class="flex gap-2">
            <button onclick="editProject(${item.id})" class="px-4 py-1 bg-yellow-400 text-white rounded hover:bg-yellow-500">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button onclick="deleteProject(${item.id})" class="px-4 py-1 bg-red-500 text-white rounded hover:bg-red-600">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>`;
    }
    function loadProjects() {
      fetch('/api/projects').then(r=>r.json()).then(items => {
        projectsList.innerHTML = items.length ? items.map(projectCard).join('') : '<div class="text-gray-400 text-center">–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</div>';
      });
    }
    window.editProject = function(id) {
      fetch(`/api/projects/${id}`).then(r=>r.json()).then(item => {
        openModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç', item, 'projects');
      });
    }
    window.deleteProject = function(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?')) return;
      fetch(`/api/projects/${id}`, {method:'DELETE'}).then(()=>loadProjects());
    }

    // --- LED CRUD ---
    const ledList = document.getElementById('led-list');
    function ledCard(item) {
      return `<div class="bg-white rounded-xl shadow flex flex-col md:flex-row items-center md:items-start gap-6 p-4">
        <img src="${item.img}" alt="img" class="w-32 h-32 object-cover rounded-lg border">
        <div class="flex-1">
          <div class="font-bold text-lg mb-1">${item.title}</div>
          <div class="text-gray-600 mb-2">${item.description || ''}</div>
          <div class="text-sm text-gray-500 mb-2">${item.location ? '–õ–æ–∫–∞—Ü–∏—è: ' + item.location : ''} ${item.price ? ' ¬∑ –¶–µ–Ω–∞: ' + item.price : ''}</div>
          <div class="flex gap-2">
            <button onclick="editLed(${item.id})" class="px-4 py-1 bg-yellow-400 text-white rounded hover:bg-yellow-500">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button onclick="deleteLed(${item.id})" class="px-4 py-1 bg-red-500 text-white rounded hover:bg-red-600">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>`;
    }
    function loadLed() {
      fetch('/api/led').then(r=>r.json()).then(items => {
        ledList.innerHTML = items.length ? items.map(ledCard).join('') : '<div class="text-gray-400 text-center">–ù–µ—Ç LED —ç–∫—Ä–∞–Ω–æ–≤</div>';
      });
    }
    window.editLed = function(id) {
      fetch(`/api/led/${id}`).then(r=>r.json()).then(item => {
        openModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å LED', item, 'led');
      });
    }
    window.deleteLed = function(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å LED?')) return;
      fetch(`/api/led/${id}`, {method:'DELETE'}).then(()=>loadLed());
    }

    // --- MODAL ---
    const modalBg = document.getElementById('modal-bg');
    const modalForm = document.getElementById('modal-form');
    const modalTitle = document.getElementById('modal-title');
    const modalId = document.getElementById('modal-id');
    const modalImgs = document.getElementById('modal-imgs');
    const modalImagesOld = document.getElementById('modal-images-old');
    const modalImgOld = document.getElementById('modal-img-old');
    const modalTitleInput = document.getElementById('modal-title-input');
    const modalDesc = document.getElementById('modal-desc');
    const imgPreview = document.getElementById('img-preview');
    const linksContainer = document.getElementById('links-container');
    const addLinkBtn = document.getElementById('add-link-btn');
    const linksBlock = document.getElementById('links-block');
    const ledExtraBlock = document.getElementById('led-extra-block');
    const modalLocation = document.getElementById('modal-location');
    let modalContext = 'blog'; // 'blog' | 'projects' | 'led'
    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç–∏–Ω–æ–∫
    let currentImagesOld = [];
    let newFiles = [];
    function limitTotal() {
      if (currentImagesOld.length + newFiles.length > 10) {
        newFiles = newFiles.slice(0, 10 - currentImagesOld.length);
      }
    }
    function renderPreviews() {
      imgPreview.innerHTML = '';
      currentImagesOld.forEach((src, idx) => {
        const wrap = document.createElement('div');
        wrap.className = 'relative group';
        wrap.draggable = true;
        wrap.innerHTML = `
          <img src="${src}" class="h-24 w-full object-cover rounded-lg border-2 border-gray-200 shadow-sm">
          <button type="button" class="absolute top-2 right-2 hidden group-hover:block bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold hover:bg-red-600 transition">√ó</button>
        `;
        wrap.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', String(idx));
        });
        wrap.addEventListener('dragover', (e) => e.preventDefault());
        wrap.addEventListener('drop', (e) => {
          e.preventDefault();
          const from = parseInt(e.dataTransfer.getData('text/plain'));
          const to = idx; if (Number.isNaN(from) || from === to) return;
          const item = currentImagesOld.splice(from, 1)[0];
          currentImagesOld.splice(to, 0, item);
          modalImagesOld.value = JSON.stringify(currentImagesOld);
          renderPreviews();
        });
        wrap.querySelector('button').onclick = () => {
          currentImagesOld.splice(idx, 1);
          modalImagesOld.value = JSON.stringify(currentImagesOld);
          limitTotal();
          renderPreviews();
        };
        imgPreview.appendChild(wrap);
      });
      newFiles.forEach((file, idx) => {
        const url = URL.createObjectURL(file);
        const wrap = document.createElement('div');
        wrap.className = 'relative group';
        wrap.innerHTML = `
          <img src="${url}" class="h-24 w-full object-cover rounded-lg border-2 border-gray-200 shadow-sm">
          <button type="button" class="absolute top-2 right-2 hidden group-hover:block bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold hover:bg-red-600 transition">√ó</button>
        `;
        wrap.querySelector('button').onclick = () => {
          newFiles.splice(idx, 1);
          limitTotal();
          renderPreviews();
        };
        imgPreview.appendChild(wrap);
      });
    }
    modalImgs.onchange = function() {
      const files = Array.from(this.files);
      newFiles = newFiles.concat(files);
      limitTotal();
      renderPreviews();
      this.value = '';
    };
    function renderLinks(values) {
      linksContainer.innerHTML = '';
      (values || []).slice(0,5).forEach((v, idx) => addLinkInput(v));
      if (!values || values.length === 0) addLinkInput('');
    }
    function addLinkInput(value) {
      const count = linksContainer.querySelectorAll('input[type="url"]').length;
      if (count >= 5) return;
      const wrap = document.createElement('div');
      wrap.className = 'flex gap-2';
      wrap.innerHTML = `<input type="url" placeholder="https://..." class="flex-1 px-4 py-3 border rounded-lg" value="${value || ''}">
        <button type="button" class="px-4 py-3 rounded-lg bg-red-500 text-white hover:bg-red-600 transition font-bold">√ó</button>`;
      const removeBtn = wrap.querySelector('button');
      removeBtn.onclick = () => { wrap.remove(); };
      linksContainer.appendChild(wrap);
    }
    addLinkBtn.onclick = () => addLinkInput('');
    document.getElementById('add-btn').onclick = () => openModal('–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç', null, 'blog');
    document.getElementById('add-project-btn').onclick = () => openModal('–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç', null, 'projects');
    document.getElementById('add-led-btn').onclick = () => openModal('–î–æ–±–∞–≤–∏—Ç—å LED', null, 'led');
    document.getElementById('modal-close').onclick = closeModal;
    modalBg.onclick = (e) => { if (e.target === modalBg) closeModal(); };
    function openModal(title, post, context) {
      modalContext = context || 'blog';
      modalTitle.textContent = title;
      modalId.value = post ? post.id : '';
      const imgs = (post && Array.isArray(post.images) && post.images.length) ? post.images : (post && post.img ? [post.img] : []);
      currentImagesOld = [...imgs];
      newFiles = [];
      modalImgs.value = '';
      modalImgOld.value = imgs[0] || '';
      modalImagesOld.value = JSON.stringify(currentImagesOld);
      renderPreviews();
      modalTitleInput.value = post ? post.title : '';
      document.getElementById('modal-title-uz').value = post ? (post.title_uz || '') : '';
      document.getElementById('modal-title-en').value = post ? (post.title_en || '') : '';
      modalDesc.value = post ? post.description : '';
      document.getElementById('modal-desc-uz').value = post ? (post.description_uz || '') : '';
      document.getElementById('modal-desc-en').value = post ? (post.description_en || '') : '';
      // toggle blocks
      if (modalContext === 'led') {
        linksBlock.classList.add('hidden');
        ledExtraBlock.classList.remove('hidden');
        modalLocation.value = post ? (post.location || '') : '';
      } else {
        ledExtraBlock.classList.add('hidden');
        linksBlock.classList.remove('hidden');
        renderLinks((post && Array.isArray(post.links)) ? post.links : []);
      }
      document.getElementById('modal-save-btn').textContent = post ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å';
      modalBg.classList.remove('hidden');
    }
    function closeModal() {
      modalBg.classList.add('hidden');
      modalForm.reset();
    }
    modalForm.onsubmit = async (e) => {
      e.preventDefault();
      
      const title = modalTitleInput.value.trim();
      const desc = modalDesc.value.trim();
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º, –µ—Å–ª–∏ –ø–æ–ª—è UZ/EN –ø—É—Å—Ç—ã–µ
      const titleUz = document.getElementById('modal-title-uz').value.trim();
      const titleEn = document.getElementById('modal-title-en').value.trim();
      const descUz = document.getElementById('modal-desc-uz').value.trim();
      const descEn = document.getElementById('modal-desc-en').value.trim();
      
      const saveBtn = document.getElementById('modal-save-btn');
      const originalText = saveBtn.textContent;
      saveBtn.textContent = 'üîÑ –ü–µ—Ä–µ–≤–æ–¥–∏–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º...';
      saveBtn.disabled = true;
      
      try {
        // –ü–µ—Ä–µ–≤–æ–¥–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (title && (!titleUz || !titleEn)) {
          const titleResponse = await fetch('/api/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: title, lang: 'all' })
          });
          const titleData = await titleResponse.json();
          if (titleData.translations) {
            if (!titleUz) document.getElementById('modal-title-uz').value = titleData.translations.uz || '';
            if (!titleEn) document.getElementById('modal-title-en').value = titleData.translations.en || '';
          }
        }
        
        // –ü–µ—Ä–µ–≤–æ–¥–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (desc && (!descUz || !descEn)) {
          const descResponse = await fetch('/api/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: desc, lang: 'all' })
          });
          const descData = await descResponse.json();
          if (descData.translations) {
            if (!descUz) document.getElementById('modal-desc-uz').value = descData.translations.uz || '';
            if (!descEn) document.getElementById('modal-desc-en').value = descData.translations.en || '';
          }
        }
        
        // –¢–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ–º
        const id = modalId.value;
        const formData = new FormData();
        const files = newFiles.slice(0, 10 - currentImagesOld.length);
        files.forEach(f => formData.append('imgs', f));
        formData.append('imagesOld', JSON.stringify(currentImagesOld));
        formData.append('imgOld', (currentImagesOld[0] || ''));
        formData.append('title', modalTitleInput.value);
        formData.append('title_uz', document.getElementById('modal-title-uz').value);
        formData.append('title_en', document.getElementById('modal-title-en').value);
        formData.append('description', modalDesc.value);
        formData.append('description_uz', document.getElementById('modal-desc-uz').value);
        formData.append('description_en', document.getElementById('modal-desc-en').value);
        let base = '/api/blog';
        if (modalContext === 'projects') base = '/api/projects';
        if (modalContext === 'led') {
          base = '/api/led';
          formData.append('location', modalLocation.value || '');
        } else {
          const links = Array.from(linksContainer.querySelectorAll('input[type="url"]')).map(i => i.value.trim()).filter(Boolean).slice(0,5);
          links.forEach(v => formData.append('links', v));
        }
        
        if (id) {
          const response = await fetch(`${base}/${id}`, { method: 'POST', body: formData });
          if (!response.ok) throw new Error('fail');
          closeModal(); 
          modalContext === 'projects' ? loadProjects() : (modalContext === 'led' ? loadLed() : loadBlog());
        } else {
          if ((currentImagesOld.length + files.length) === 0) { 
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É –∫–∞—Ä—Ç–∏–Ω–∫—É'); 
            return; 
          }
          const response = await fetch(base, { method: 'POST', body: formData });
          if (!response.ok) throw new Error('fail');
          closeModal(); 
          modalContext === 'projects' ? loadProjects() : (modalContext === 'led' ? loadLed() : loadBlog());
        }
      } catch (error) {
        console.error('Save error:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.');
      } finally {
        saveBtn.textContent = originalText;
        saveBtn.disabled = false;
      }
    };

    // --- Tabs switch ---
    const tabBlog = document.getElementById('tab-blog');
    const tabProjects = document.getElementById('tab-projects');
    const tabLed = document.getElementById('tab-led');
    const blogSection = document.getElementById('blog-section');
    const projectsSection = document.getElementById('projects-section');
    const ledSection = document.getElementById('led-section');
    function setTab(tab) {
      if (tab === 'blog') {
        blogSection.classList.remove('hidden');
        projectsSection.classList.add('hidden');
        ledSection.classList.add('hidden');
        tabBlog.classList.add('bg-blue-100','text-blue-700');
        tabBlog.classList.remove('bg-gray-200','text-gray-700');
        tabProjects.classList.add('bg-gray-200','text-gray-700');
        tabProjects.classList.remove('bg-blue-100','text-blue-700');
        tabLed.classList.add('bg-gray-200','text-gray-700');
        tabLed.classList.remove('bg-blue-100','text-blue-700');
      } else if (tab === 'projects') {
        projectsSection.classList.remove('hidden');
        blogSection.classList.add('hidden');
        ledSection.classList.add('hidden');
        tabProjects.classList.add('bg-blue-100','text-blue-700');
        tabProjects.classList.remove('bg-gray-200','text-gray-700');
        tabBlog.classList.add('bg-gray-200','text-gray-700');
        tabBlog.classList.remove('bg-blue-100','text-blue-700');
        tabLed.classList.add('bg-gray-200','text-gray-700');
        tabLed.classList.remove('bg-blue-100','text-blue-700');
      } else {
        ledSection.classList.remove('hidden');
        blogSection.classList.add('hidden');
        projectsSection.classList.add('hidden');
        tabLed.classList.add('bg-blue-100','text-blue-700');
        tabLed.classList.remove('bg-gray-200','text-gray-700');
        tabBlog.classList.add('bg-gray-200','text-gray-700');
        tabBlog.classList.remove('bg-blue-100','text-blue-700');
        tabProjects.classList.add('bg-gray-200','text-gray-700');
        tabProjects.classList.remove('bg-blue-100','text-blue-700');
      }
    }
    tabBlog.onclick = () => setTab('blog');
    tabProjects.onclick = () => setTab('projects');
    tabLed.onclick = () => setTab('led');
    setTab('blog');

    // --- TRANSLATION FUNCTIONS ---
    
    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π
    document.getElementById('translate-all-btn').onclick = () => {
      const title = modalTitleInput.value.trim();
      const desc = modalDesc.value.trim();
      
      if (!title && !desc) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ');
        return;
      }
      
      const btn = document.getElementById('translate-all-btn');
      const originalText = btn.textContent;
      btn.textContent = 'üîÑ –ü–µ—Ä–µ–≤–æ–¥–∏–º...';
      btn.disabled = true;
      
      const promises = [];
      
      // –ü–µ—Ä–µ–≤–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞
      if (title) {
        promises.push(
          fetch('/api/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: title, lang: 'all' })
          })
          .then(r => r.json())
          .then(data => ({ type: 'title', data }))
        );
      }
      
      // –ü–µ—Ä–µ–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è
      if (desc) {
        promises.push(
          fetch('/api/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: desc, lang: 'all' })
          })
          .then(r => r.json())
          .then(data => ({ type: 'desc', data }))
        );
      }
      
      Promise.all(promises)
        .then(results => {
          results.forEach(result => {
            if (result.data.translations) {
              if (result.type === 'title') {
                document.getElementById('modal-title-uz').value = result.data.translations.uz || '';
                document.getElementById('modal-title-en').value = result.data.translations.en || '';
              } else if (result.type === 'desc') {
                document.getElementById('modal-desc-uz').value = result.data.translations.uz || '';
                document.getElementById('modal-desc-en').value = result.data.translations.en || '';
              }
            }
          });
        })
        .catch(err => {
          console.error('Translation error:', err);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ');
        })
        .finally(() => {
          btn.textContent = originalText;
          btn.disabled = false;
        });
    };
    


    // --- LOGOUT ---
    document.getElementById('logout-btn').onclick = () => {
      localStorage.removeItem('isAdmin');
      adminSection.classList.add('hidden');
      loginSection.classList.remove('hidden');
      loginForm.reset();
    };
  </script>
</body>
</html> 
</html> 